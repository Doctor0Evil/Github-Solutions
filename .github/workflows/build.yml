name: Build with ALN composite

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Start ALN Cache Orchestrator sidecar
        run: |
          docker run -d --rm \
            -p 8080:8080 \
            --name acorch-sidecar \
            ghcr.io/your-org/actions-cache-sidecar:stable

      - name: ALN cache wrapper
        uses: ./.github/actions/aln-cache
        with:
          cache-path: node_modules
          dependency-key-files: package-lock.json
          action-slug: build
          aln-policy-revision: acorch-01-ALN-001
          endpoint: http://127.0.0.1:8080/actions-cache

      # Userâ€™s actual workload between restore and store
      - name: Install dependencies
        run: npm ci

      - name: Build
        run: npm run build
